---
import PromptCard from "./PromptCard.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("blog");

// Sort posts by publication date
posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Helper to format time ago (simplified)
function timeAgo(date: Date) {
    const seconds = Math.floor((new Date().getTime() - date.getTime()) / 1000);
    let interval = seconds / 31536000;
    if (interval > 1) return Math.floor(interval) + "y ago";
    interval = seconds / 2592000;
    if (interval > 1) return Math.floor(interval) + "mo ago";
    interval = seconds / 86400;
    if (interval > 1) return Math.floor(interval) + "d ago";
    interval = seconds / 3600;
    if (interval > 1) return Math.floor(interval) + "h ago";
    interval = seconds / 60;
    if (interval > 1) return Math.floor(interval) + "m ago";
    return Math.floor(seconds) + "s ago";
}

const prompts = posts.map((post) => ({
    type: "Blog Post", // Default type
    time: timeAgo(post.data.pubDate),
    title: post.data.title,
    description: post.data.description,
    prompt: post.data.prompt || "No prompt available",
    author: "Admin", // Default author
    views: Math.floor(Math.random() * 10000).toString(), // Random views for demo
    copies: Math.floor(Math.random() * 1000).toString(), // Random copies for demo
    color: "purple", // Default color
    slug: post.id,
}));
---

<section class="max-w-7xl mx-auto px-4 sm:px-6 py-12">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {prompts.map((prompt) => <PromptCard {...prompt} />)}
    </div>

    <div class="mt-12 text-center">
        <button
            class="text-xs font-medium text-secondary hover:text-white border border-border hover:border-neutral-600 bg-surface px-6 py-2.5 rounded-md transition-all"
        >
            Load more prompts
        </button>
    </div>
</section>
